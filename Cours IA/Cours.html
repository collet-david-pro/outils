<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Formation IA – Présentation avec Remark.js</title>
  <style>
    body {
      font-family: "Source Sans Pro", Helvetica, sans-serif;
      background-color: #f7f5ec;
      color: #2d2a24;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
    #menuToggle {
      position: fixed;
      top: 10px;
      left: 10px;
      background: #398376;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      font-size: 1rem;
      border-radius: 4px;
      cursor: pointer;
      z-index: 1000;
    }
    #exportPdfBtn {
      position: fixed;
      top: 10px;
      left: 110px;
      background: #398376;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      font-size: 1rem;
      border-radius: 4px;
      cursor: pointer;
      z-index: 1000;
    }
    #toc {
      position: fixed;
      top: 50px;
      left: 10px;
      width: 280px;
      max-height: 80vh;
      overflow-y: auto;
      background: #e8e6d9;
      border: 2px solid #398376;
      border-radius: 6px;
      padding: 1rem;
      box-sizing: border-box;
      font-size: 0.9rem;
      display: none;
      z-index: 999;
    }
    #toc h2 {
      margin-top: 0;
      color: #398376;
      font-weight: 700;
      font-size: 1.2rem;
      border-bottom: 2px solid #398376;
      padding-bottom: 0.3rem;
    }
    #toc ul {
      list-style: none;
      padding-left: 0;
      margin-top: 0.5rem;
    }
    #toc li {
      margin-bottom: 0.4rem;
      cursor: pointer;
      color: #52796f;
    }
    #toc li:hover {
      color: #b85c38;
      text-decoration: underline;
    }
    .remark-slide-content {
      font-size: 1.6rem;
      line-height: 1.5;
      max-width: 900px;
      margin: 0 auto;
      padding: 2rem;
      box-sizing: border-box;
    }
    .remark-slide-content h1, .remark-slide-content h2, .remark-slide-content h3 {
      color: #398376;
      margin-top: 1rem;
      margin-bottom: 1rem;
    }
    .remark-slide-content ul, .remark-slide-content ol {
      margin-left: 1.5rem;
      margin-bottom: 1rem;
    }
    .remark-slide-content li {
      margin-bottom: 0.5rem;
    }
    .remark-slide-content blockquote {
      background: #e8e6d9;
      border-left: 4px solid #398376;
      padding: 1rem;
      margin: 1rem 0;
      font-style: italic;
    }
  </style>
</head>
<body>
  <button id="menuToggle" aria-expanded="false" aria-controls="toc">Menu</button>
  <button id="exportPdfBtn">Exporter PDF</button>
  <nav id="toc" aria-label="Plan du cours">
    <h2>Plan du cours</h2>
    <ul id="tocList"></ul>
  </nav>

  <textarea id="source" style="display:none;"></textarea>

  <script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
  <script>
    // Fetch markdown content and initialize Remark
    fetch('slides.md')
      .then(response => response.text())
      .then(md => {
        document.getElementById('source').value = md;
        window.slideshow = remark.create({
          source: md,
          highlightStyle: 'monokai',
          highlightLines: true,
          slideNumberFormat: '%current% / %total%',
          navigation: {
            scroll: false
          }
        });
        buildTOC(md);
      })
      .catch(err => {
        alert('Erreur lors du chargement du contenu markdown.');
        console.error(err);
      });

    // Build Table of Contents from markdown headings
    function buildTOC(md) {
      const tocList = document.getElementById('tocList');
      tocList.innerHTML = '';
      const lines = md.split('\n');
      lines.forEach((line, index) => {
        const match = line.match(/^(#{1,3})\s+(.*)/);
        if (match) {
          const level = match[1].length;
          const text = match[2];
          const li = document.createElement('li');
          li.textContent = text;
          li.style.marginLeft = (level - 1) * 15 + 'px';
          li.tabIndex = 0;
          li.setAttribute('role', 'link');
          li.addEventListener('click', () => {
            window.slideshow.gotoSlide(index);
            toggleMenu(false);
          });
          li.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              li.click();
            }
          });
          tocList.appendChild(li);
        }
      });
    }

    // Menu toggle
    const menuToggle = document.getElementById('menuToggle');
    const toc = document.getElementById('toc');
    menuToggle.addEventListener('click', () => {
      const expanded = menuToggle.getAttribute('aria-expanded') === 'true';
      toggleMenu(!expanded);
    });
    function toggleMenu(show) {
      if (show) {
        toc.style.display = 'block';
        menuToggle.setAttribute('aria-expanded', 'true');
      } else {
        toc.style.display = 'none';
        menuToggle.setAttribute('aria-expanded', 'false');
      }
    }

    // Export PDF using browser print
    const exportPdfBtn = document.getElementById('exportPdfBtn');
    exportPdfBtn.addEventListener('click', () => {
      window.print();
    });
  </script>
</body>
</html>
